<%- include('header'); %>
    <%- include('main'); %>

        <section class="container menu_area white" style="margin-top: 119px;">
           

            <div class="row w-100">
                <div class="card w-100 m-4 p-1">
                    <div class="card-header">
                        Atendimento ao cliente
                    </div>
                    <div class="card-body ">

                        <p class="card-text w-100" id="txt-msg">

                        </p>

                    </div>
                    <div class="input-group mb-3 p-3">
                        <input type="text" id="input" class="form-control" placeholder="enviar mensagem" autocomplete="off"  aria-label="Recipientâ€™s username" aria-describedby="button-addon2">
                        <button class="btn btn-outline-secondary w-100 mt-4" type="button"
                            onclick="enviarMensagem(event)" id="button-addon2"><i class="bi bi-send"></i> Enviar</button>
                    </div>

                </div>


            </div>
            <div class="row p-0 m-0">
                <form accept-charset="UTF-8" role="form" class="form-signin" action="/chat" method="post">
                    <div class=" container form-floating mb-3 mt-4 m-0">
                        <input type="text" class="form-control " id="nickname" name="nickname" placeholder="nickname">
                        <button type="submit" class="btn btn-primary w-100 mt-4 ">Entrar</button>
                    </div>
                </form>
            </div>






            <div id="preloader"></div>
        </section>
        <script src="https://cdn.socket.io/4.8.1/socket.io.min.js"></script>
        <script>
            const socket = io();

            const input = document.getElementById('input');
            const txt_msg = document.getElementById('txt-msg');

            function enviarMensagem(event) {
                event.preventDefault();

                let msg = input.value;

                if (msg) {

                    socket.emit('chat_msg', msg);
                    input.value = '';
                }
            }



            socket.on('chat_msg', (msg) => {
                const item = document.createElement('div');
                item.setAttribute("class", "list-group-item");
                item.textContent = msg;
                txt_msg.appendChild(item);
                window.scrollTo(0, document.body.scrollHeight);

            });
            let preloader = document.getElementById('preloader');
            if (preloader) {
                window.addEventListener('load', () => {
                    preloader.remove();
                })
            }
        </script>
        <script src="./js/jquery-3.2.1.min.js"></script>
        <script src="./js/popper.js"></script>
        <script src="./js/bootstrap.min.js"></script>
        <script src="./js/jquery.lightbox.js"></script>
        <script src="./js/theme.js"></script>
        <script src="./js/geolocation.js"></script>